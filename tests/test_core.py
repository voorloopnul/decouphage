from src.core import get_database_default_path, cds_calling_from_genbank, validate_input


def test_path_for_default_database():
    assert ".decouphage/db/nr/nr.fa" in str(get_database_default_path())


def test_can_identify_file_type():
    assert "GENBANK" == validate_input("data/AP019417.1.gb")
    assert "FASTA" == validate_input("data/two_contigs.fasta")


def test_no_orf_calling():
    expected_result = {"AP019417.1": [
        ">1_590_763_+", ">2_1345_1488_+", ">3_1466_1882_+", ">4_1882_2646_+", ">5_2966_4396_+",
        ">6_4396_6537_+", ">7_6554_6700_+", ">8_6706_7776_+", ">9_7792_8835_+", ">10_8894_9199_+",
        ">11_9203_9907_+", ">12_9912_13547_+", ">13_13637_13744_+", ">14_13744_14451_+",
        ">15_14461_16125_+", ">16_16125_18413_+", ">17_18557_18946_+", ">18_18946_19575_+",
        ">19_19575_20237_+", ">20_20237_21445_+", ">21_21455_24238_+", ">22_24249_24434_+",
        ">23_24480_24704_-", ">24_24706_25098_-", ">25_25098_25328_-", ">26_25328_26404_-",
        ">27_26404_28500_-", ">28_28490_29338_-", ">29_29350_29562_-", ">30_29627_30388_-",
        ">31_30481_30813_-", ">32_30813_30992_-", ">33_30992_32929_-", ">34_32929_33375_-",
        ">35_33393_35093_-", ">36_35234_35359_-", ">37_35362_36111_-", ">38_36126_36350_-",
        ">39_36361_37026_-", ">40_37026_37526_-", ">41_37528_37887_-", ">42_37880_38311_-",
        ">43_38337_38576_-", ">44_38579_38860_-", ">45_38823_39320_-", ">46_39344_40498_-",
        ">47_40512_41357_-", ">48_41354_41950_-", ">49_41962_42810_-", ">50_42836_44188_-",
        ">51_44487_44690_-", ">52_44690_45382_-", ">53_45384_46868_-", ">54_46896_47111_-",
        ">55_47113_47586_-", ">56_47878_48072_-", ">57_48082_48393_-", ">58_48524_48712_-",
        ">59_48715_49221_-", ">60_49232_49438_-"]
    }

    assert expected_result == cds_calling_from_genbank("data/AP019417.1.gb")
